/*!
 * =============================
 * =	Mike Pinto             =
 * =	mspkvp@github.com      =
 * =	Â©2017 tk7movespretty   =
 * ============================= */
"use strict";function getCookie(){if(void 0!==Cookies.get("tk7moves")){var e=JSON.parse(Cookies.get("tk7moves"));selected_char=e.selected_char,lang=e.lang,jap=e.jap,bl_choice=e.bl_choice}else setCookie()}function setCookie(){Cookies.set("tk7moves",JSON.stringify({selected_char:selected_char,lang:lang,jap:jap,bl_choice:bl_choice}),{expires:30,path:""})}function isLetter(e){return e.toLowerCase()!=e.toUpperCase()}function setLang(e){lang=parseInt(e),jap=0===lang,setCookie(),fetchmovelist(selected_char)}function selectChar(e){d3.select(".move-table").remove(),d3.select(".char-movelist .inner-table").html('<table class="move-table"></table>');var s=char_data[selected_char].c.split(" ");d3.select("#"+s[0]).classed("selected",!1),s=char_data[selected_char=e].c.split(" "),d3.select("#"+s[0]).classed("selected",!0),d3.select("#selected-title").text(char_data[selected_char].n),setCookie()}var char_data=[],ctrls_map,hits_map=[],selected_char="32",lang=1,jap=!1,prefDialog=!1,button_layouts=["STEAM","PS4","XBOX"],bl_choice=2;String.prototype.hexEncode=function(){var e,s="";for(e=0;e<this.length;e++)s+=("000"+this.charCodeAt(e).toString(16)).slice(-4);return s},String.prototype.hexDecode=function(){var e,s=this.match(/.{1,4}/g)||[],t="";for(e=0;e<s.length;e++)t+=String.fromCharCode(parseInt(s[e],16));return t};var togglePreferences=function(){prefDialog?d3.select("#preferences").style("visibility","hidden"):d3.select("#preferences").style("visibility","visible"),prefDialog=!prefDialog},changePlatform=function(e){bl_choice=e,setCookie(),fetchmovelist(selected_char)},importdata=function(){getCookie(),d3.json("./assets/data/map_hits.json",function(e,s){for(var t in s)hits_map[s[t].i]=s[t].h;d3.json("./assets/data/map_ctrls.json",function(e,s){ctrls_map=s,d3.json("./assets/data/map_chars.json",function(e,s){for(var t in s)char_data[s[t].i]={c:s[t].c,n:s[t].n};for(let e=0;e<s.length;e++){var a=s[e].c.split(" ");"11"==s[e].i&&(a=s[e].c.split("-")),d3.select(".char-menu > .inner-table > table").append("tr").html('<td class="char-card" id="'+s[e].c.split(" ")[0]+'"><img src="./assets/chars/'+a.join("").toLowerCase()+'_thumbnail.png"><p>'+s[e].c+"</p></td>"),d3.select("#"+s[e].c.split(" ")[0]).on("click",function(){fetchmovelist(s[e].i)})}var o=char_data[selected_char].c.split(" ");d3.select("#"+o[0]).classed("selected",!0),d3.select("#selected-title").text(char_data[selected_char].n),fetchmovelist(selected_char)})})})},fetchmovelist=function(e){d3.json("./assets/data/movelists/MOVELIST_"+e+".json",function(s,t){selectChar(e);var a=0;for(let s=0;s<t.moves.length;s++){if(!t.moves[s].number>0){let e='<td class="move-card"><div class="move-info"><div class="move-number">&#9733;</div><div class="move-title"><div class="move-name" style="margin-bottom:5px;">'+t.moves[s].name[jap?0:1]+"</div></div></div></td>";d3.select(".move-table").append("tr").html(e);continue}a++;var o='<td class="move-card"><div class="move-info"><div class="move-number">'+t.moves[s].number+'</div><div class="move-title"><div class="move-name">'+t.moves[s].name[jap?0:1]+'</div><div class="move-hitamount">'+t.moves[s].ds.length+(t.moves[s].ds.length>1?" Hits":" Hit")+"</div></div>";o+='<div class="move-string">';let l=t.moves[s].command[lang].split(" ");for(let e=0;e<l.length;e++)if(/[a-z]/.test(l[e].toLowerCase()))o+='<p class="move-hint">'+l[e]+"</p>";else for(let s=0;s<l[e].length;s++)try{isLetter(ctrls_map[l[e].charAt(s)])?ctrls_map[l[e].charAt(s)]===ctrls_map[l[e].charAt(s)].toLowerCase()||"N"===ctrls_map[l[e].charAt(s)]?o+='<img class="move-arrow" src="./assets/arrow/'+ctrls_map[l[e].charAt(s)].toLowerCase()+'.svg">':o+='<img class="move-arrow" src="./assets/arrow/'+ctrls_map[l[e].charAt(s)].toLowerCase()+'p.svg">':isNaN(ctrls_map[l[e].charAt(s)].charAt(0))?">"===ctrls_map[l[e].charAt(s)]?o+='<p class="move-hint" style="color:#37ff05;font-size:20px;"><i class="fa fa-chevron-right" aria-hidden="true"></i></p>':(console.log("1. Not added: "+l[e].charAt(s)),console.log("2. Not added map: "+ctrls_map[l[e].charAt(s)])):o+='<img class="move-button" src="./assets/button/'+button_layouts[bl_choice]+"/"+ctrls_map[l[e].charAt(s)]+'.svg">'}catch(t){"("===l[e].charAt(s)||l[e].charAt(s),o+='<p class="move-hint">'+l[e].charAt(s)+"</p>"}o+='</div><div class="move-hit-dmg"><div class="move-hitlvlstring">';for(let a=0;a<t.moves[s].at.length;a++){try{o+='<p class="mv-hitlvl hit'+hits_map[t.moves[s].at[a].l].toLowerCase()+'">'+hits_map[t.moves[s].at[a].l]+(t.moves[s].at[a].t>0?" Throw":"")+"</p>"}catch(o){throw console.log(t.moves[s].at[a].l),console.log(hits_map[t.moves[s].at[a].l]),console.log("Fighter: "+e),console.log(t.moves[s].number),o}a+1<t.moves[s].at.length&&(o+='<i class="fa fa-chevron-right" aria-hidden="true"></i>')}if(t.moves[s].br.length>0){let e="";switch(t.moves[s].br[0].b){case 1:e="1";break;case 2:e="2";break;case 3:e="1/2";break;case 4:e="1+2";break;default:e=""}o+='<i class="fa fa-caret-right" aria-hidden="true"></i>',o+='<p class="mv-hitlvl">'+t.moves[s].br[0].f+"F BREAK "+e+"</p>"}o+="</div>",o+='<div class="move-dmg"><p class="mv-frames">'+t.moves[s].d+'</p><p class="mv-id">Damage</p><div class="move-hitdmg-section"><i id="dmgmove'+t.moves[s].number+'" class="fa fa-plus-square" aria-hidden="true"></i><div class="move-hitdmg">';for(let e=0;e<t.moves[s].ds.length;e++)o+=t.moves[s].ds[e].d,e+1<t.moves[s].ds.length&&(o+="+");if(o+="</div></div></div></div></div>",o+='<div class="move-extra"><div class="mv-section"><div class="move-special">',t.moves[s].b9&&(o+='<p class="spin">SPIN</p>'),t.moves[s].b8&&(o+='<p class="armor">ARMOR</p>'),t.moves[s].bB&&(o+='<p class="track">TRACK</p>'),o+="</div>",o+='<table class="move-frames"><tr class="move-startf"><td class="mv-id">Start</td><td class="mv-frames">'+t.moves[s].s+"F</td></tr>",t.moves[s].s>0){o+='<tr class="move-startf-seg"><td>'+t.moves[s].s+"F = ";for(var c=1;c<t.moves[s].ss.length;c++)o+=t.moves[s].ss[c].s,c+1<t.moves[s].ss.length&&(o+="+");o+="</td></tr>"}o+='<tr class="move-blockf"><td class="mv-id">Block</td><td class="mv-frames '+(t.moves[s].blk>-1?'blkpositive">+':t.moves[s].blk<-10?'blknegative">':'blkmild">')+t.moves[s].blk+"</td></tr>",o+='<tr class="move-hitf"><td class="mv-id">Hit</td><td class="mv-frames">'+(t.moves[s].adv>0?"+"+t.moves[s].adv:t.moves[s].adv)+"</td></tr></table>",o+="</div>",o+="</div></td>",d3.select(".move-table").append("tr").html(o)}for(var l=1;l<=a;l++){var i=l;d3.select("#dmgmove"+i).on("mouseenter",function(){d3.select("i#"+this.id+" + div.move-hitdmg").style("display","initial")}),d3.select("#dmgmove"+l).on("mouseleave",function(){var e=this.id;setTimeout(function(){d3.select("i#"+e+" + div.move-hitdmg").style("display","none")},3e3)})}})};